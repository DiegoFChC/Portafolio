---
const { images } = Astro.props
---

<div class='carouser-container'>
  <div class='carousel-slide'>
    <div class='item'>
      <img
        src={images[images.length - 1].img}
        alt='image-slide'
        id='lastClone'
      />
    </div>
    {
      images?.map((item) => {
        return (
          <div class='item'>
            <img src={item.img} alt='image-slide' />
            <span>{item.description}</span>
          </div>
        )
      })
    }
    <div class='item'>
      <img src={images[0].img} alt='image-slide' id='firstClone' />
    </div>
  </div>
</div>
<div class='navigation'>
  <button id='prevBtn'>Prev</button>
  <button id='nextBtn'>Next</button>
</div>

<style>
  .carouser-container {
    width: 100%;
    margin: auto;
    border-radius: 10px;
    overflow: hidden;
  }

  .carousel-slide {
    display: flex;
    width: 100%;
    height: 500px;
  }

  .item {
    min-width: 100%;
    height: 500px;
    position: relative;
  }

  .item img {
    min-width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .item span {
    padding: 20px 30px;
    background: rgba(0, 0, 0, 0.205);
    color: white;
    font-weight: bold;
    font-size: 2rem;
    border-top: 1px solid rgba(255, 255, 255, 0.5);
    border-bottom: 1px solid rgba(255, 255, 255, 0.5);
    backdrop-filter: blur(5px);
    position: absolute;
    right: 30px;
    bottom: 30px;
  }

  .navigation {
    width: 100%;
    margin-top: 10px;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
</style>

<script>
  const $carouselSlide = document.querySelector('.carousel-slide')
  const $carouselImages = document.querySelectorAll('.carousel-slide .item')

  // Buttons
  const $prevBtn = document.getElementById('prevBtn')
  const $nextBtn = document.getElementById('nextBtn')

  // Counter
  let counter = 1
  let size
  const $btnOpenModal = document.querySelector('.open-modal')
  console.log($btnOpenModal)
  $btnOpenModal.addEventListener('click', () => {
    setTimeout(() => {
      size = $carouselImages[0].clientWidth
      $carouselSlide.style.transform = `translateX(${-size * counter}px)`
    }, 100)
  })

  // Button listeners
  $nextBtn.addEventListener('click', () => {
    if (counter >= $carouselImages.length - 1) return
    $carouselSlide.style.transition = 'transform .4s ease-in-out'
    counter++
    $carouselSlide.style.transform = `translateX(${-size * counter}px)`
  })

  $prevBtn.addEventListener('click', () => {
    if (counter <= 0) return
    $carouselSlide.style.transition = 'transform .4s ease-in-out'
    counter--
    $carouselSlide.style.transform = `translateX(${-size * counter}px)`
  })

  $carouselSlide.addEventListener('transitionend', () => {
    if ($carouselImages[counter].querySelector('img').id === 'lastClone') {
      $carouselSlide.style.transition = 'none'
      counter = $carouselImages.length - 2
      $carouselSlide.style.transform = `translateX(${-size * counter}px)`
    } else if (
      $carouselImages[counter].querySelector('img').id === 'firstClone'
    ) {
      $carouselSlide.style.transition = 'none'
      counter = $carouselImages.length - counter
      $carouselSlide.style.transform = `translateX(${-size * counter}px)`
    }
  })
</script>
